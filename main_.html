<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="">
        <title>::.APPREDA MOVIL.::</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/bootstrap-table.css" rel="stylesheet" type="text/css"/>
        <link href="css/font-awesome.css" rel="stylesheet" type="text/css"/>
        <link href="css/styles.css" rel="stylesheet">
    </head>
    <body>
        <div class="content-wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <nav class="navbar navbar-default" >
                            <div class="container">
                                <div class="navbar-header">
                                    <!--button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                                        <span class="sr-only"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                    </button-->
                                    <a href="main.php" class="navbar-brand active">APPREDA MOVIL</a>
                                </div>
                                <!--div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                                    <ul class="nav navbar-nav navbar-left" id="ulModulos">
                                    </ul>
                                    <ul class="nav navbar-nav navbar-right" id="ulDerecha">
                                    </ul>
                                </div-->
                            </div>
                        </nav>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-112 col-xs-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"></h3>
                            </div>
                            <div class="panel-body">
                                <form class="form-horizontal">
                                    <div class="form-group" id="div-operaciones">
                                        <label for="selectOperacion" class="col-sm-2 control-label">CAMPAÑA </label>
                                        <div class="col-sm-10">
                                            <select class="form-control" id="selectOperacion">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group" id="div-encuestas">
                                        <label for="selectEncuesta" class="col-sm-2 control-label">ENCUESTA </label>
                                        <div class="col-sm-10">
                                            <select class="form-control" id="selectEncuesta">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group" id="div-entidades">
                                        <label for="selectEntidades" class="col-sm-2 control-label">ENTIDAD: </label>
                                        <div class="col-sm-10">
                                            <select class="form-control" id="selectEntidades">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group" id="div-municipios">
                                        <label for="selectMunicipios" class="col-sm-2 control-label">MUNICIPIO: </label>
                                        <div class="col-sm-10">
                                            <select class="form-control" id="selectMunicipios">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group" id="div-secciones">
                                        <label for="selectSecciones" class="col-sm-2 control-label">SECCION: </label>
                                        <div class="col-sm-10">
                                            <select class="form-control" id="selectSecciones">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputNombres" class="col-sm-2 control-label">NOMBRES:</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="inputNombres">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputApellidoP" class="col-sm-2 control-label">APELLIDO PATERNO: </label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="inputApellidoP">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputApellidoM" class="col-sm-2 control-label">APELLIDO MATERNO: </label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="inputApellidoM">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-12">
                                            <button type="button" id="buscar" class="btn btn-primary ">BUSCAR</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-112 col-xs-12">
                        <div class="panel panel-default">
                            <div class="panel-heading" style="text-align:center;">ELECTORES</div>
                            <div class="panel-body">
                                <input type="hidden" id="id" value="<?php echo $id?>"/>
                                <table id="table-electores-totales" data-sort-name="" data-sort-order="asc" data-show-refresh="false" data-show-toggle="false" data-show-columns="true" data-search="true" data-show-export="true" data-pagination="true" data-page-list="[5, 10, 20, 50, 100, 200, 500, 1000]"  data-toolbar-align="right"></table>
                            </div>
                        </div>				        	
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <div class="container">
                <p class="text-muted">escala</p>
            </div>
        </footer>
        <script src="js/jquery-1.11.2.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootstrap-table.js" type="text/javascript"></script>
        <script>
            
            var URL                 = null;
            var METODO              = null;
            var VALOR               = null;
            var LOADER              = null;
            var ERROR               = null;
            var DATA                = null;
            var ENCUESTADOR         = null;
            var COD_ELECTOR         = null;
            
            var OPERACIONES         = null;
            var COD_OPERACION       = null;
            var NOMBRE_OPERACION    = null;
            
            var ENCUESTAS           = null;
            var COD_ENCUESTA        = null;   
            var NOMBRE_ENCUESTA     = null;
            
            var ENTIDADES           = null;
            var COD_ENTIDAD         = null;
            var NOMBRE_ENTIDAD      = null;
            
            var MUNICIPIOS          = null;
            var COD_MUNICIPIO       = null;
            var NOMBRE_MUNICIPIO    = null;
            
            var SRCCIONES           = null;
            var COD_SECCION         = null;
            var NOMBRE_SECCION      = null;

            var SESSION_DATA = 
            {
                storeUserDataInSession: function(userData) 
                {
                    var userObjectString = JSON.stringify(userData);
                    window.sessionStorage.setItem('userObject',userObjectString);
                },
                getUserDataFromSession: function() 
                {
                    var userData = window.sessionStorage.getItem('userObject');
                    return JSON.parse(userData);
                }
           };

            function call_Ajax_Jsonp(URL, METODO, VALOR, LOADER, ERROR, FN) 
            {
                $.ajax
                ({
                    type: "GET",
                    //url: "http://escala.org.mx/APPREDA_MOVIL/common/ws.php?format=json",
                    url: "common/ws.php?format=json",
                    data:
                    {
                        m: METODO,
                        v: VALOR
                    },
                    dataType: "jsonp",
                    jsonp: "callback",
                    jsonpCallback: "JasonpCallback",
                    async: false,
                    beforeSend: function()
                    {
                        $(LOADER).css("display", "block");
                        $(LOADER).css("padding-bottom", "15px");
                    },
                    complete: function()
                    {
                        $(LOADER).css("display", "none");
                    },
                    success: function(data)
                    {
                        FN(data);
                    },
                    error: function () 
                    {
                        $(ERROR).css("display", "block");
                        $(ERROR).html("<p style='padding:10px; color:red;'>No se pudo conectar, por favor intente nuevamente.</p>");
                    }
                });
            }
            
            function buscarSeccionesMunicipio(municipios, clave) 
            {
                A = clave;
                $.each(municipios, function(key)
                {
                    B = municipios[key].COD_MUNICIPIO;
                    if(A === B)
                    {
                        SECCIONES =  municipios[key].SECCIONES; 

                        $('#selectSecciones').empty();
                        if (SECCIONES.length === 1)
                        {
                            COD_SECCION         = SECCIONES[0].COD_SECCION;
                            NOMBRE_SECCION      = SECCIONES[0].COD_SECCION;
                            $("#div-secciones").css("display", "none");
                        }  
                        else if (SECCIONES.length >=  1)
                        {
                            $('#selectSecciones').append($('<option disabled selected value> -- SELECCIONE -- </option>'));
                            $.each(SECCIONES, function(key)
                            {
                                COD_SECCION         = SECCIONES[key].COD_SECCION;
                                NOMBRE_SECCION      = SECCIONES[key].COD_SECCION;
                                $('#selectSecciones').append($('<option>',{
                                    value:  COD_SECCION,
                                    text:   COD_SECCION}
                                ));
                                $("#div-secciones").css("display", "block");
                            });
                            $('#selectSecciones').prop('disabled', false);
                        }
                        else
                        {
                            ERROR = "ESTS CAMPAÑA NO TIENE SECCIONES ASIGNADAS, POR FAVOR CONTACTE AL ADMINISTRADOR DEL SISTEMA";
                        }  
                    }
                });       
            }
            
            function buscarMunicipiosEntidad(entidades, clave) 
            {
                A = clave;
                $.each(entidades, function(key)
                {
                    B = entidades[key].COD_ENTIDAD;
                    if(A === B)
                    {
                        MUNICIPIOS =  entidades[key].MUNICIPIOS; 
                        $('#selectMunicipios').empty();
                        if (MUNICIPIOS.length === 1)
                        {
                            COD_MUNICIPIO       = MUNICIPIOS[0].COD_MUNICIPIO;
                            NOMBRE_MUNICIPIO    = MUNICIPIOS[0].NOMBRE;
                            buscarSeccionesMunicipio(MUNICIPIOS,MUNICIPIOS[0].COD_MUNICIPIO);
                            $("#div-municipios").css("display", "none");
                        }
                        else if (MUNICIPIOS.length >=  1)
                        {
                            $('#selectMunicipios').append($('<option disabled selected value> -- SELECCIONE -- </option>'));
                            $.each(MUNICIPIOS, function(key)
                            {
                                COD_MUNICIPIO       = MUNICIPIOS[key].COD_MUNICIPIO;
                                NOMBRE_MUNICIPIO    = MUNICIPIOS[key].NOMBRE;
                                $('#selectMunicipios').append($('<option>',{
                                    value:  COD_MUNICIPIO,
                                    text:   NOMBRE_MUNICIPIO.toUpperCase()}
                                ));
                                $("#div-municipios").css("display", "block");
                            });
                            $('#municipios').prop('disabled', false);
                        }
                        else
                        {
                            ERROR = "ESTS CAMPAÑA NO TIENE MUNICIPIOS ASIGNADOS, POR FAVOR CONTACTE AL ADMINISTRADOR DEL SISTEMA";
                        }  
                    }
                });       
            }
            
            function buscarEncuestasEntidadesOperacion(operaciones, clave) 
            {
                A = clave;
                $.each(operaciones, function(key)
                {
                    B = operaciones[key].COD_OPERACION;
                    if(A === B)
                    {
                        ENCUESTAS =  operaciones[key].ENCUESTAS; 
                        ENTIDADES =  operaciones[key].ENTIDADES; 
                        
                        $('#selectEncuesta').empty();
                        $('#selectEntidades').empty();

                        if (ENCUESTAS.length === 1)
                        {
                            COD_ENCUESTA        = ENCUESTAS[0].COD_ENCUESTA;
                            NOMBRE_ENCUESTA     = ENCUESTAS[0].NOMBRE;
                            $("#div-encuestas").css("display", "none");
                        }
                        else if (ENCUESTAS.length >=  1)
                        {
                            $('#selectEncuesta').append($('<option disabled selected value> -- SELECCIONE -- </option>'));
                            $.each(ENCUESTAS, function(key)
                            {
                                COD_ENCUESTA       = ENCUESTAS[key].COD_ENCUESTA;
                                NOMBRE_ENCUESTA    = ENCUESTAS[key].NOMBRE;
                                $('#selectEncuesta').append($('<option>',{
                                    value:  COD_ENCUESTA,
                                    text:   NOMBRE_ENCUESTA.toUpperCase()}
                                ));
                                $("#div-encuestas").css("display", "block");
                            });
                            $('#selectEncuesta').prop('disabled', false);
                        }
                        else
                        {
                            ERROR = "ESTS CAMPAÑA NO TIENE ENCUESTAS ASIGNADAS, POR FAVOR CONTACTE AL ADMINISTRADOR DEL SISTEMA";
                        }

                        if (ENTIDADES.length === 1)
                        {
                            COD_ENTIDAD         = ENTIDADES[0].COD_ENTIDAD;
                            NOMBRE_ENTIDAD      = ENTIDADES[0].NOMBRE;
                            buscarMunicipiosEntidad(ENTIDADES,ENTIDADES[0].COD_ENTIDAD);
                            $("#div-entidades").css("display", "none");
                        }  
                        else if (ENTIDADES.length >=  1)
                        {
                            $('#selectEntidades').append($('<option disabled selected value> -- SELECCIONE -- </option>'));
                            $.each(ENTIDADES, function(key)
                            {
                                COD_ENTIDAD         = ENTIDADES[key].COD_ENTIDAD;
                                NOMBRE_ENTIDAD      = ENTIDADES[key].NOMBRE;
                                $('#selectEntidades').append($('<option>',{
                                    value:  COD_ENTIDAD,
                                    text:   NOMBRE_ENTIDAD.toUpperCase()}
                                ));
                                $("#div-entidades").css("display", "block");
                            });
                            $('#selectEntidades').prop('disabled', false);
                        }
                        else
                        {
                            ERROR = "ESTS CAMPAÑA NO TIENE ENTIDADES ASIGNADAS, POR FAVOR CONTACTE AL ADMINISTRADOR DEL SISTEMA";
                        }  
                    }
                });       
            }
            
            $(document).ready(function()
            {
                localStorage.removeItem("COD_OPERACIONES_ELECTORES");
                sessionStorage.removeItem("COD_OPERACIONES_ELECTORES");
                
                DATA = SESSION_DATA.getUserDataFromSession();
                OPERACIONES = DATA.OPERACIONES;
                $('#selectOperacion').empty();

                if (OPERACIONES.length === 1)
                {
                    COD_OPERACION       = OPERACIONES[0].COD_OPERACION;
                    NOMBRE_OPERACION    = OPERACIONES[0].NOMBRE;
                    buscarEncuestasEntidadesOperacion(OPERACIONES,OPERACIONES[0].COD_OPERACION);
                    $("#div-operaciones").css("display", "none");
                }  
                else if (OPERACIONES.length >=  1)
                {
                    $('#selectOperacion').append($('<option disabled selected value> -- SELECCIONE -- </option>'));
                    $.each(OPERACIONES, function(key)
                    {
                        COD_OPERACION       = OPERACIONES[key].COD_OPERACION;
                        NOMBRE_OPERACION    = OPERACIONES[key].NOMBRE;
                        $('#selectOperacion').append($('<option>',{
                            value:  COD_OPERACION,
                            text:   NOMBRE_OPERACION.toUpperCase()}
                        ));
                        $("#div-operaciones").css("display", "block");
                    });
                    $('#selectOperacion').prop('disabled', false);
                }
                else
                {
                    ERROR = "NO TIENE CAMPAÑAS ASIGNADAS, POR FAVOR CONTACTE AL ADMINISTRADOR DEL SISTEMA";
                }

                $('#selectOperacion').change(function() 
                {
                    CLAVE = $(this).val();
                    buscarEncuestasEntidadesOperacion(OPERACIONES,CLAVE); 
                });
                
                $('#selectEntidades').change(function() 
                {
                    CLAVE = $(this).val();
                    buscarMunicipiosEntidad(); 
                });
                
                $('#selectMunicipios').change(function() 
                {
                    CLAVE = $(this).val();
                    buscarSeccionesMunicipio(); 
                });
                
                $('#selectSecciones').change(function() 
                {
                    CLAVE = $(this).val();
                });
                
                
                
                 $("#buscar").click(function()
                {
                    COD_SECCION = $("#selectSecciones option:selected" ).text();
                    NOMBRES     = $("#inputNombres").val().toUpperCase();
                    APELLIDO_P  = $("#inputApellidoP").val().toUpperCase();
                    APELLIDO_M  = $("#inputApellidoM").val().toUpperCase();
                    
                    if(COD_SECCION === "")
                    {
                        COD_SECCION = "VACIO";
                    }
                    
                    if(NOMBRES === "")
                    {
                        NOMBRES = "VACIO";
                    }
                    
                    if(APELLIDO_P === "")
                    {
                        APELLIDO_P = "VACIO";
                    }
                    
                    if(APELLIDO_M === "")
                    {
                        APELLIDO_M = "VACIO";
                    }
                    
                    
                    if (COD_SECCION === "VACIO" && NOMBRES === "VACIO" && APELLIDO_P === "VACIO" && APELLIDO_M === "VACIO")
                    {
                        alert("DEBE SELECCIONAR AL MENOS UN FILTRO");
                    }
                    else
                    {
                        
                        URL     = "common/ws.php?format=json";
                        METODO  = "CONSULTAR_ELECTORES_2";
                        VALOR   = COD_OPERACION + "|" + COD_ENTIDAD + "|" + COD_MUNICIPIO + "|" + COD_SECCION + "|" + NOMBRES + "|" + APELLIDO_P + "|" + APELLIDO_M;

                        call_Ajax_Jsonp(URL, METODO, VALOR, LOADER, ERROR, function(data) 
                        {
                            
                            
                            DATA = data.ELECTORES;
                            $('#table-electores-totales').bootstrapTable('removeAll');
                            $('#table-electores-totales').bootstrapTable('destroy');
                            console.log(DATA);
                            
                            
                            $('#table-electores-totales').bootstrapTable
                            ({
                               data: DATA,
                               columns: 
                               [
                                   {
                                        field: 'COD_OPERACIONES_ELECTORES',
                                        title: 'CODIGO',
                                        align: 'center',
                                        valign: 'middle',
                                        width: 1
                                   }, 
                                   {
                                        field: 'NOMBRES',
                                        title: 'NOMBRES',
                                        align: 'center',
                                        valign: 'middle',
                                   },
                                   {
                                        field: 'COD_OPERACIONES_ELECTORES',
                                        title: 'ENCUESTAR',
                                        align: 'center',
                                        valign: 'middle',
                                        width: 1,
                                        formatter : function() 
                                        {
                                            return '<button class="btn btn-link" class="link"><span class="fa fa-edit" aria-hidden="true" style="text-align:center;"></span></a>';  
                                        }
                                   }
                                   
                               ],
                               onClickCell: function (field, value, row) 
                               {
                                    if (field === "COD_OPERACIONES_ELECTORES")
                                    { 
                                        alert("ELECTOR: " + value + " CAMPAÑA: " + COD_OPERACION + " ENCUESTA: " + COD_ENCUESTA);
                                        localStorage.setItem("COD_OPERACIONES_ELECTORES", value);
                                        sessionStorage.setItem("COD_OPERACIONES_ELECTORES", value);
                                        
                                        localStorage.setItem("COD_OPERACION", COD_OPERACION);
                                        sessionStorage.setItem("COD_OPERACION", COD_OPERACION);
                                        
                                        localStorage.setItem("COD_ENCUESTA", COD_ENCUESTA);
                                        sessionStorage.setItem("COD_ENCUESTA", COD_ENCUESTA);
                                        
                                        $(location).attr('href',"encuesta.html");
                                        
                                        /*
                                        COD_OPERACIONES_ELECTORES   = ROW.COD_OPERACIONES_ELECTORES;
                                        TELEFONO_CELULAR            = ROW.TELEFONO_CELULAR;
                                        TELEFONO_FIJO               = ROW.TELEFONO_FIJO;
                                        $('#modal-informacion').modal('show');
                                        $(".modal-body #id-elector").val(COD_OPERACIONES_ELECTORES);
                                        $(".modal-body #celular").val(TELEFONO_CELULAR);
                                        $(".modal-body #fijo").val(TELEFONO_FIJO);*/
                                        
                                    }
                               }
                               
                            });                      
                        });
                    }  
                });
            });

        </script>
    </body>
</html>
